# 埋点助手

这是我入职一年后做的一个代码埋点的工具，开发这个工具的有两个目的，第一个是磨平埋点平台之间的差异，公司内部有两套埋点系统，可能两套系统都需要用，让开发者不需要关注埋点平台的差异。第二个目的是想提供更优雅的方式去埋点，需要支持多种类型的入参和完善的 TS 类型，目前提供了几种方式的埋点，一种是传统的函数调用，另一种是针对 class 提供了装饰器埋点，还为了 Vue/react 针对性开发了一些 hook/组件/指令的方式。还内置了页面停留时长的监控。

项目是我入职后写的第一个脚本工具，当时不管是 react 还是 vue 都在用 class 组件，所以开发的重点放在了装饰器的开发上，需要针对 class/property/method 做不同的处理，

比较有争议的点的是属性装饰器，因为 react 会写箭头函数，babel 针对属性是箭头函数的做了一层处理，导致 descriptor 会多一个 initializer 的属性，这个属性会在类初始化的时候被调用然后返回 bind 后的方法，需要针对这一点做个兼容。装饰 method 需要修改 value，装饰属性需要通过 defineProperty 修改 get/set，主要是进行切面处理，同时还要支持多种类型的参数，比如字符串、对象，数组、函数。

# 分享

我做课题分享的时候着重点在如何通过装饰器进行切面编程，和一点点的 Reflect 元编程入门
