# 响应式系统优化

实际上简单的 defineProperty 比 Proxy 是要慢的，但是因为 vue2 中采用 defineProperty 加深度遍历所有属性来劫持对象，给每个属性添加 getter 和 setter。vue3 采用 proxy 重写了响应式系统，因为 proxy 可以对单个对象进行监听，对于深层次的对象采用懒代理，所以不需要深度遍历。初始化的过程和内存占用方面肯定是 Proxy 更好。

可以监听动态属性的添加、可以监听到数组的索引和数组 length 属性、可以监听删除属性

# diff 算法优化

vue3 在 diff 算法中相比 vue2 增加了静态标记，其作用是为了会发生变化的地方添加一个 flag 标记，下次发生变化的时候直接找该地方进行比较。

# 静态提升

Vue3 中对不参与更新的元素，会做静态提升，只会被创建一次，在渲染时直接复用。免去了重复的创建操作，优化内存。
没做静态提升之前，未参与更新的元素也在 render 函数内部，会重复创建阶段。
做了静态提升后，未参与更新的元素，被放置在 render 函数外，每次渲染的时候只要取出即可。同时该元素会被打上静态标记值为-1，特殊标志是负整数表示永远不会用于 Diff。

# 事件监听缓存

# 源码体积

相比 Vue2，Vue3 整体体积变小了，还支持了 Tree shanking。任何一个函数 ref、reavtived、computed 等，仅仅在用到的时候才打包，没用到的模块都被摇掉，打包的整体体积变小。当然大型项目用 api 的多所以不会很明显。

#
